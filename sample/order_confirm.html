<?
$buyer_no = isset($_POST['buyer_no']) ? $_POST['buyer_no'] : "";
$buyer_name = isset($_POST['buyer_name']) ? $_POST['buyer_name'] : "";
$buyer_hp = isset($_POST['buyer_hp']) ? $_POST['buyer_hp'] : "";
$buyer_email = isset($_POST['buyer_email']) ? $_POST['buyer_email'] : "";
$buy_goods = isset($_POST['buy_goods']) ? $_POST['buy_goods'] : "";
$buy_total = isset($_POST['buy_total']) ? preg_replace("/([^0-9]+)/", "", $_POST['buy_total']) : "";
$order_num = isset($_POST['order_num']) ? $_POST['order_num'] : "";
$is_reguler = isset($_POST['is_reguler']) ? $_POST['is_reguler'] : "";
$pay_year = isset($_POST['pay_year']) ? preg_replace("/([^0-9]+)/", "", $_POST['pay_year']) : "";
$pay_month = isset($_POST['pay_month']) ? preg_replace("/([^0-9]+)/", "", $_POST['pay_month']) : "";
$is_taxsave = isset($_POST['is_taxsave']) ? $_POST['is_taxsave'] : "";
?>
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no" />
<title>Insert title here</title>
<script src="/js/jquery-3.2.1.min.js"></script>
<script src="https://testcpay.payple.kr/js/cpay.payple.1.0.1.js"></script> <!-- TEST -->
<!-- <script src="https://cpay.payple.kr/js/cpay.payple.1.0.1.js"></script> --> <!-- REAL -->
<script>
$(document).ready( function () {
	
	$('#payAction').on('click', function (event) {
		var obj = new Object();
		
		obj.PCD_CPAY_VER = "1.0.1";			// 결제창 버전 (Default : 1.0.0)
		obj.PCD_PAY_TYPE = 'transfer';			// 결제 방법 (transfer : 계좌 | card : 신용카드)
		obj.PCD_PAY_WORK = 'CERT';			// 결제요청 업무구분 (CERT: 결제정보인증등록, PAY: 결제승인요청 )
		
		//-- PCD_PAYER_ID 는 소스상에 표시하지 마시고 반드시 Server Side Script 를 이용하여 불러오시기 바랍니다. --//
		obj.PCD_PAYER_ID = '<?=$payple_payer_id?>';	// [간편결제/정기결제] 결제자 고유ID (본인인증 된 결제회원 고유 KEY)
		//--------------------------------------------------------------------------------------------//
		
		obj.PCD_PAYER_NAME = '<?=$buyer_name?>';	// 결제자 이름
		obj.PCD_PAYER_HP = '<?=$buyer_hp?>';		// 결제자 휴대폰 번호
		obj.PCD_PAYER_EMAIL = '<?=$buyer_email?>';	// 결제자 Email
		obj.PCD_PAY_GOODS = '<?=$buy_goods?>';		// 결제 상품
		obj.PCD_PAY_TOTAL = '<?=$buy_total?>';		// 결제 금액
		obj.PCD_PAY_OID = '<?=$order_num?>';		// 주문번호 (미입력 시 임의 생성)
		obj.PCD_REGULER_FLAG = '<?=$is_reguler?>';	// 정기결제 여부 (Y|N)
		obj.PCD_PAY_YEAR = '<?=$pay_year?>';		// [정기결제] 결제 구분 년도 (PCD_REGULER_FLAG : 'Y' 일때 필수)
		obj.PCD_PAY_MONTH = '<?=$pay_month?>';		// [정기결제] 결제 구분 월 (PCD_REGULER_FLAG : 'Y' 일때 필수)
		obj.PCD_TAXSAVE_FLAG = '<?=$is_taxsave?>';	// 현금영수증 발행 여부 (Y|N)
		obj.PCD_SIMPLE_FLAG = '<?=$simple_flag?>';	// 간편결제 여부 (Y|N)
		obj.PCD_PAYER_AUTHTYPE = 'pwd';			// [간편결제/정기결제] 본인인증 방식 (sms : 문자인증 | pwd : 패스워드 인증)
		obj.PCD_RST_URL = '/order_result.html';		// 결제(요청)결과 RETURN URL
		obj.payple_dir_path = '/pg/pay';		// cPayPayple 폴더 경로 (ex: /shop/cPayPayple 은 /shop 로 지정)
		obj.payple_auth_file = 'payple_payAuth.php';	// cPayPayple 폴더의 payple_payAuth.html 대체파일 명

		PaypleCpayAuthCheck(obj);
		
		event.preventDefault();		
	});
	
});
</script>
</head>
<body>
	<table border="1" cellspacing="0" cellpadding="1">
		<tr>
	  		<td>구매자 이름</td>
	    	<td><?=$buyer_name?></td>
		</tr>
		<tr>
	    	<td>구매자 휴대폰번호</td>
	    	<td><?=$buyer_hp?></td>
	    </tr>
	    <tr>
	    	<td>구매자 Email</td>
	    	<td><?=$buyer_email?></td>
	    </tr>
	  	<tr>
	    	<td>구매상품</td>
	    	<td><?=$buy_goods?></td>
	    </tr>	  
	    <tr>
	  		<td>결제금액</td>
	  		<td><?=$buy_total?></td>
	    </tr>
	    <tr>
	  		<td>주문번호</td>
	  		<td><?=$order_num?></td>
	  	</tr>
	  	<tr>
	  		<td>정기결제</td>
	  		<td><?=$is_reguler?></td>
	    </tr>
	    <tr>
	  		<td>정기결제 구분년도</td>
	  		<td><?=$pay_year?></td>
	    </tr>
	    <tr>
	  		<td>정기결제 구분월</td>
	  		<td><?=$pay_month?></td>
	  	</tr>
	  	<tr>
	  		<td>현금영수증</td>
	  		<td><?=$is_taxsave?></td>
	  	</tr>
	  	<tr>
	  		<td colspan="2" align="center">
	  			<button id="payAction">결제하기</button>
	  		</td>
	  	</tr>
	  </table>
</body>
</html>
